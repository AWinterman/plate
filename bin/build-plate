#!/usr/bin/env node
var sys = require('sys'),
    fn = function(callback) {
    var items = [
                    'utils',
                    'nodes',
                    'tags/block',
                    'tags/extends',
                    'tags/for',
                    'tags/if',
                    'tags/include',
                    'tags/with',
                    'tags/comment',
                    'filters/add',
                    'filters/addslashes',
                    'filters/capfirst',
                    'filters/center',
                    'filters/cut',
                    'filters/default',
                    'filters/dictsort',
                    'filters/dictsortreversed',
                    'filters/divisibleby',
                    'filters/filesizeformat',
                    'filters/first',
                    'filters/floatformat',
                    'filters/get_digit',
                    'filters/index',
                    'filters/iriencode',
                    'filters/join',
                    'filters/last',
                    'filters/length',
                    'filters/length_is',
                    'filters/linebreaks',
                    'filters/linebreaksbr',
                    'filters/linenumbers',
                    'filters/ljust',
                    'filters/lower',
                    'filters/make_list',
                    'filters/phone2numeric',
                    'filters/pluralize',
                    'filters/random',
                    'filters/rjust',
                    'filters/safe',
                    'filters/slice',
                    'filters/slugify',
                    'filters/striptags',
                    'filters/title',
                    'filters/truncatewords',
                    'filters/unordered_list',
                    'filters/upper',
                    'filters/urlencode',
                    'filters/urlize',
                    'filters/urlizetrunc',
                    'filters/wordcount',
                    'filters/wordwrap',
                    'filters/yesno',
                    'libraries',
                    'parsers',
                    'tokens',
                    'index'
        ],
        fs = require('fs'),
        path = require('path'),
        data = items.map(function(item) {
            var realFilename = path.join(process.cwd(), 'lib', item+'.js');

            return [item, function(callback) {
                fs.readFile(realFilename, function(err, data) {
                    callback(err, data.toString());
                });
            }];
        }),
        plate = require('plate'),
        template = new plate.Template(fs.readFileSync(path.join(__dirname, 'filetemplate.js')).toString())

        template.render({data:data}, callback); 
};

fn(function(err, data) {
    sys.puts(err || data);
});
